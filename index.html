<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z E Z O</title>
    <link rel="icon" type="image/png" href="https://i.ibb.co/5x8nfvWy/Tomioka-Giyuu-full-2852832.png">
    <link href="https://fonts.cdnfonts.com/css/minecraftia" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Base and Animation Styles */
        :root {
            --primary-glow: rgba(168, 85, 247, 0.5);
            --primary-color: #a855f7;
            --primary-dark: #9333ea;
            --background-start: #181b2c;
            --background-end: #232946;
            --text-light: #ddd;
            --text-white: #fff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        html { 
            scroll-behavior: smooth; 
            background-color: var(--background-start);
        }
        
        body, html { width: 100%; }
        body { min-height: 100vh; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; color: var(--text-white); text-align: center; position: relative; overflow-x: hidden; background: linear-gradient(180deg, var(--background-start) 0%, var(--background-end) 100%); padding-top: 80px; padding-bottom: 160px; }
        
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            display: block;
        }
        
        /* Profile Card Styles */
        .profile { background: linear-gradient(135deg, rgba(168, 85, 247, .18) 0, rgba(147, 51, 234, .18) 100%); padding: 32px 28px; border-radius: 28px; width: 90%; max-width: 370px; box-shadow: 0 0 32px 0 var(--primary-glow), 0 8px 32px 0 rgba(0,0,0,.25); position: relative; border: 2px solid rgba(168, 85, 247, .25); animation: profileFadeIn 1.2s cubic-bezier(.77,0,.18,1) both; transition: box-shadow .5s, border .5s, background .5s; z-index: 1; flex-shrink: 0; }
        .profile:hover { box-shadow: 0 0 48px 0 var(--primary-color), 0 8px 48px 0 var(--primary-dark); border: 2.5px solid var(--primary-color); background: linear-gradient(120deg, rgba(168, 85, 247, .28) 0, rgba(147, 51, 234, .28) 100%); }
        @keyframes profileFadeIn { 0% { opacity: 0; transform: scale(.92) translateY(40px); filter: blur(6px) } 100% { opacity: 1; transform: scale(1) translateY(0); filter: blur(0) } }
        .avatar-container { position: relative; display: inline-block; width: 116px; height: 116px; margin: 0 auto; }
        .avatar-border { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(from 0deg, #a855f7 0, #9333ea 25%, #7e22ce 50%, #6b21a8 75%, #a855f7 100%); animation: spin 3s linear infinite; z-index: 0; }
        @keyframes spin { 0% { transform: rotate(0) } 100% { transform: rotate(360deg) } }
        .profile img#profile-pic { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--text-white); position: absolute; top: 8px; left: 8px; z-index: 1; transition: transform .5s ease, filter .5s ease; }
        .avatar-container:hover img#profile-pic { transform: scale(1.03); filter: brightness(1.1); }
        .profile h1#user-name { margin: 15px 0 5px; font-size: 1.8em; letter-spacing: 3px; }
        .profile p { font-size: .95em; color: var(--text-light); }
        .social-icons { margin-top: 20px; }
        .social-icons a { color: var(--text-white); text-decoration: none; margin: 0 10px; font-size: 1.4em; display: inline-block; transition: transform .4s ease, color .4s ease; }
        .social-icons a:hover { color: #c084fc; transform: scale(1.3) rotate(5deg); }

        /* Whitelist & Gallery Button Section Styles */
        .action-section { margin-top: 20px; border-top: 1px solid rgba(168, 85, 247, 0.4); padding-top: 20px; }
        .action-section h3 { font-family: 'Minecraftia', sans-serif; color: #c084fc; letter-spacing: 1px; margin-bottom: 15px; }
        
        .action-controls-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .action-buttons { display: flex; justify-content: center; gap: 10px; }
        .action-btn { font-family: 'Minecraftia', sans-serif; font-size: 1em; background: linear-gradient(90deg, var(--primary-dark) 60%, var(--primary-color) 100%); border: 2px solid var(--primary-color); color: var(--text-white); padding: 10px 25px; border-radius: 12px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 2px 12px #9333eacc; }
        .action-btn:hover { transform: translateY(-3px) scale(1.05); box-shadow: 0 6px 25px var(--primary-glow); }
        
        .collapsible-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, opacity 0.4s ease-in-out, padding-top 0.5s ease-in-out;
            padding-top: 0;
            width: 100%;
        }
        .collapsible-content.visible {
            max-height: 500px;
            opacity: 1;
            padding-top: 5px;
        }
        
        #whitelist-form { padding-top: 0; }
        .whitelist-inner-form { display: flex; align-items: center; justify-content: center; gap: 10px; }
        .mc-input-container { display: flex; align-items: center; background: rgba(0,0,0,0.2); border: 2px solid var(--primary-color); border-radius: 12px; padding: 5px; flex-grow: 1; }
        #mc-head-preview { width: 38px; height: 38px; margin-right: 10px; image-rendering: pixelated; transition: transform 0.2s; flex-shrink: 0; }
        #mc-username-input { background: transparent; border: none; color: var(--text-white); font-family: 'Minecraftia', sans-serif; font-size: 1em; outline: none; flex-grow: 1; padding: 5px; width: 100%; }
        #send-whitelist-btn { flex-shrink: 0; padding: 12px 18px; background: linear-gradient(90deg, var(--primary-color) 60%, #c084fc 100%); border: none; border-radius: 12px; color: white; cursor: pointer; transition: transform 0.2s; font-size: 1.2em; }
        #send-whitelist-btn:hover { transform: scale(1.1); }
        #whitelist-message { font-family: 'Minecraftia', sans-serif; margin-top: 10px; min-height: 18px; color: #c084fc; }
        #cooldown-timer { font-family: 'Minecraftia', sans-serif; margin-top: 10px; color: #fca5a5; }

        /* Auth Section Styles */
        .auth-container { position: fixed; top: 20px; right: 20px; z-index: 1001; }
        #login-btn-redesigned { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: var(--text-white); padding: 10px 20px; border-radius: 50px; cursor: pointer; font-family: 'Segoe UI', sans-serif; font-size: 0.9em; transition: all 0.3s ease; backdrop-filter: blur(5px); display: flex; align-items: center; gap: 10px; }
        #login-btn-redesigned:hover { background: rgba(255, 255, 255, 0.2); border-color: var(--primary-color); }
        #login-btn-redesigned .fab.fa-google { color: #DB4437; font-size: 1.2em; }
        
        #user-profile-area { display: none; position: relative; }
        #auth-user-pic { width: 45px; height: 45px; border-radius: 50%; border: 2px solid #c084fc; cursor: pointer; }
        #user-menu {
            display: none;
            position: absolute;
            top: 55px;
            right: 0;
            background-color: rgba(35, 41, 70, 0.9);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(168, 85, 247, 0.5);
            border-radius: 12px;
            padding: 10px;
            width: 220px;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            animation: fadeInMenu 0.2s ease-out;
        }
        @keyframes fadeInMenu { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        #user-menu.visible { display: flex; }
        #user-menu #auth-user-name { font-weight: bold; font-size: 1.1em; padding: 5px; }
        #user-menu .menu-item-btn {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        #user-menu .menu-item-btn:hover { background: rgba(255, 255, 255, 0.15); }
        #user-menu #logout-btn { background: #e53e3e; }
        #logout-btn:hover { background: #c53030; }

        /* Screenshot Gallery Styles */
        .screenshot-gallery-container {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.7s ease-in-out, opacity 0.5s ease-in-out, margin-top 0.7s ease-in-out, padding 0.7s ease-in-out;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(135deg, rgba(24, 27, 44, 0.5) 0%, rgba(35, 41, 70, 0.5) 100%);
            backdrop-filter: blur(10px);
            border-radius: 28px;
            border: 2px solid rgba(168, 85, 247, 0.25);
            box-shadow: 0 8px 32px 0 rgba(0,0,0,0.3);
            z-index: 1;
            position: relative;
            padding: 0 20px;
        }
        .screenshot-gallery-container.visible {
            max-height: 10000px;
            opacity: 1;
            margin-top: 60px;
            padding: 40px 20px;
        }
        .screenshot-gallery-container h2 { font-family: 'Minecraftia', 'Segoe UI', sans-serif; font-size: 1.8em; letter-spacing: 2px; color: #c084fc; text-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-dark); margin-bottom: 25px; }
        .upload-area { border: 2px dashed rgba(168, 85, 247, 0.5); border-radius: 15px; padding: 25px 20px; text-align: center; cursor: pointer; transition: background-color 0.3s, border-color 0.3s, transform 0.2s; position: relative; }
        .upload-area:hover { transform: translateY(-3px); border-color: #c084fc; background-color: rgba(168, 85, 247, 0.1); }
        .upload-area.disabled { cursor: not-allowed; background-color: rgba(0,0,0,0.3); border-color: #555; }
        .upload-area.disabled p { color: #888; }
        .upload-icon { font-size: 2em; color: #c084fc; margin-bottom: 10px; }
        .upload-area p { font-family: 'Minecraftia', sans-serif; color: var(--text-light); font-size: 1em; }
        .upload-area p strong { color: #c084fc; }
        #upload-message { margin-top: 15px; color: #c084fc; font-family: 'Minecraftia', sans-serif; min-height: 20px; text-shadow: 0 0 6px var(--primary-color); }
        #screenshot-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 40px; min-height: 250px; }
        .screenshot-item { position: relative; border-radius: 15px; overflow: hidden; border: 2px solid rgba(168, 85, 247, 0.4); box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.3s, box-shadow 0.3s; }
        .screenshot-item:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--primary-color), 0 8px 30px rgba(0,0,0,0.4); }
        .screenshot-item img.main-img { width: 100%; height: 100%; object-fit: cover; display: block; cursor: pointer; }
        
        .uploader-info { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0, 0, 0, 0.6); color: white; padding: 8px; display: flex; align-items: center; justify-content: space-between; transition: opacity 0.3s; opacity: 0; }
        .screenshot-item:hover .uploader-info { opacity: 1; }
        .uploader-details { display: flex; align-items: center; gap: 8px; }
        .uploader-details img { width: 30px; height: 30px; border-radius: 50%; border: 1px solid #c084fc; }
        .uploader-info-text { display: flex; flex-direction: column; align-items: flex-start; }
        .uploader-info-text .name { font-size: 0.9em; font-weight: bold; text-shadow: 1px 1px 3px black; }
        .uploader-info-text .time-ago { font-size: 0.75em; color: #bbb; }
        .like-section { display: flex; align-items: center; gap: 5px; font-size: 1em; cursor: pointer; padding: 5px; border-radius: 5px; transition: color .2s; }
        .like-section .fa-heart { color: var(--text-light); transition: color 0.2s, transform 0.2s; }
        .like-section.liked .fa-heart { color: #e53e3e; }
        .like-section .fa-heart.animating { animation: heartPop 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes heartPop { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.4); } }
        
        .image-controls { position: absolute; top: 5px; right: 5px; display: flex; gap: 5px; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 8px; opacity: 0; transition: opacity 0.3s; }
        .screenshot-item:hover .image-controls { opacity: 1; }
        .control-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.1em; padding: 5px; border-radius: 5px; transition: background 0.2s, color 0.2s; }
        .control-btn.hide-btn:hover { background: #facc15; color: black; }
        .control-btn.delete-btn:hover { background: #ef4444; color: white; }
        .screenshot-item.hidden-by-admin { opacity: 0.4; border-color: #facc15; }
        .screenshot-item.hidden-by-admin .control-btn.hide-btn { color: #facc15; }

        /* Redesigned Lightbox/Modal */
        #lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 3000; padding: 20px; }
        #lightbox.visible { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #lightbox-content { display: flex; flex-direction: column; max-width: 90vw; max-height: 95vh; width: auto; height: auto; }
        #lightbox-img { width: 100%; height: 100%; object-fit: contain; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        #lightbox-info { display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; color: var(--text-light); margin-top: 10px; }
        #lightbox-uploader { display: flex; align-items: center; gap: 10px; }
        #lightbox-uploader img { width: 40px; height: 40px; border-radius: 50%; }
        #lightbox-uploader .name { font-weight: bold; color: var(--text-white); }
        #lightbox-actions { display: flex; gap: 20px; align-items: center; }
        #lightbox-like-section { font-size: 1.2em; }
        #lightbox-close { position: absolute; top: 15px; right: 20px; font-size: 2.5em; color: white; cursor: pointer; text-shadow: 0 0 10px black; transition: transform 0.2s; }
        #lightbox-close:hover { transform: scale(1.1); }

        /* Pagination Controls */
        .pagination-controls { display: flex; justify-content: center; align-items: center; margin-top: 40px; font-family: 'Minecraftia', sans-serif; gap: 10px; }
        .pagination-btn { font-family: inherit; font-size: 1em; background: linear-gradient(90deg, var(--primary-dark) 60%, var(--primary-color) 100%); border: 2px solid var(--primary-color); color: var(--text-white); padding: 8px 16px; border-radius: 10px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .pagination-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 15px var(--primary-color); background: linear-gradient(90deg, var(--primary-color) 60%, #c084fc 100%); }
        .pagination-btn:disabled { background: #4a5568; border-color: #718096; cursor: not-allowed; opacity: 0.6; }
        #page-numbers { display: flex; align-items: center; gap: 5px; }
        .page-number { font-size: 1.2em; color: #aaa; padding: 5px 10px; cursor: pointer; transition: color 0.2s, transform 0.2s; }
        .page-number:hover { color: #c084fc; transform: scale(1.1); }
        .page-number.active { color: var(--text-white); background-color: rgba(168, 85, 247, 0.3); border-radius: 5px; font-weight: bold; }

        /* Modal Styles (Generic) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: var(--background-end); padding: 30px; border-radius: 20px; border: 1px solid var(--primary-color); text-align: center; max-width: 400px; width: 90%; box-shadow: 0 0 30px var(--primary-color); transform: scale(0.9); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease; position: relative; }
        .modal-overlay.visible { display: flex; }
        .modal-overlay.visible .modal-content { transform: scale(1); opacity: 1; }
        .modal-content h3 { font-family: 'Minecraftia', sans-serif; margin-bottom: 15px; color: #c084fc; }
        .modal-content p { margin-bottom: 25px; color: var(--text-light); }
        .modal-buttons { display: flex; justify-content: center; gap: 15px; }
        .modal-btn { padding: 10px 25px; border-radius: 10px; border: none; font-family: 'Minecraftia', sans-serif; font-size: 1em; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        #modal-confirm-btn { background: #e53e3e; color: white; box-shadow: 0 2px 10px #e53e3e88; }
        #modal-confirm-btn:hover { transform: scale(1.05); box-shadow: 0 4px 15px #e53e3e; }
        #modal-cancel-btn { background: #4a5568; color: white; }
        #modal-cancel-btn:hover { transform: scale(1.05); }
        .modal-close-btn { position: absolute; top: 10px; right: 15px; font-size: 2em; color: var(--text-light); cursor: pointer; transition: color 0.2s, transform 0.2s; }
        .modal-close-btn:hover { color: var(--text-white); transform: scale(1.1); }

        /* Admin Modal Specifics */
        .admin-modal-content { max-width: 800px; width: 90%; padding: 20px; padding-top: 40px; }
        
        /* Music Player */
        #music-player { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(15, 18, 30, 0.8); backdrop-filter: blur(10px); border-top: 1px solid var(--primary-glow); padding: 15px 20px; display: flex; justify-content: center; align-items: center; gap: 20px; z-index: 1000; }
        #music-player .track-info { text-align: left; width: 200px; overflow: hidden; white-space: nowrap; }
        #music-player .track-title { font-weight: bold; text-overflow: ellipsis; overflow: hidden; }
        #music-player .track-artist { font-size: 0.8em; color: var(--text-light); }
        #music-player .controls button { background: none; border: none; color: var(--text-white); font-size: 1.5em; cursor: pointer; transition: color 0.2s, transform 0.2s; }
        #music-player .controls button:hover { color: var(--primary-color); transform: scale(1.1); }
        #music-player .controls { display: flex; align-items: center; gap: 15px; }

        /* Admin Panel (inside modal) */
        #admin-panel { width: 100%; margin: 0; padding: 0; background: none; border: none; }
        #admin-panel h2 { font-family: 'Minecraftia', sans-serif; color: #c084fc; margin-bottom: 20px; }
        .admin-section { margin-bottom: 30px; }
        .admin-section h3 { text-align: left; margin-bottom: 15px; border-bottom: 1px solid var(--primary-glow); padding-bottom: 5px; }
        .toggle-switch, .admin-input-group { display: flex; align-items: center; gap: 10px; justify-content: space-between; margin-bottom: 10px; }
        .toggle-switch label, .admin-input-group label { font-size: 1.1em; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-dark); }
        input:checked + .slider:before { transform: translateX(26px); }
        #user-list { max-height: 300px; overflow-y: auto; text-align: left; }
        .user-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 8px; }
        .user-item:nth-child(odd) { background-color: rgba(255,255,255,0.05); }
        .user-info { display: flex; align-items: center; gap: 10px; }
        .user-info img { width: 30px; height: 30px; border-radius: 50%; }
        .user-role-btn { font-size: 0.9em; padding: 5px 10px; }
        .add-admin-form, .admin-input-group { display: flex; gap: 10px; margin-top: 10px; }
        .add-admin-form input, .admin-input-group input { flex-grow: 1; padding: 8px; border-radius: 8px; border: 1px solid var(--primary-color); background: rgba(0,0,0,0.2); color: var(--text-white); }
        #add-admin-message { margin-top: 10px; min-height: 18px; }

        /* Chatbot Styles */
        #chat-toggle-btn { position: fixed; bottom: 90px; right: 20px; width: 60px; height: 60px; background: var(--primary-dark); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8em; cursor: pointer; z-index: 1001; box-shadow: 0 0 20px var(--primary-glow); transition: transform 0.3s ease; }
        #chat-toggle-btn:hover { transform: scale(1.1); }
        #chatbot-container { position: fixed; bottom: 100px; right: 20px; width: 90%; max-width: 350px; height: 500px; background: var(--background-start); border: 1px solid var(--primary-color); border-radius: 15px; box-shadow: 0 5px 30px rgba(0,0,0,0.4); display: none; flex-direction: column; z-index: 1002; overflow: hidden; transform: scale(0.95) translateY(10px); opacity: 0; transition: transform 0.3s ease, opacity 0.3s ease; }
        #chatbot-container.visible { display: flex; transform: scale(1) translateY(0); opacity: 1; }
        #chatbot-header { padding: 15px; background: var(--background-end); display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--primary-color); }
        #chatbot-header img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; }
        #chatbot-header .chatbot-title { text-align: left; flex-grow: 1; }
        #chatbot-header .chatbot-title h3 { margin: 0; font-size: 1.1em; }
        #chatbot-header .chatbot-title span { font-size: 0.8em; color: #4ade80; }
        #chatbot-close-btn { background: none; border: none; color: var(--text-light); font-size: 1.5em; cursor: pointer; }
        #chatbot-messages { flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .bot-message { align-self: flex-start; background: #334155; padding: 10px 15px; border-radius: 15px 15px 15px 0; max-width: 80%; text-align: left; line-height: 1.5; }
        .bot-message .copy-container { display: flex; align-items: center; justify-content: space-between; background: #1e293b; padding: 5px 10px; border-radius: 4px; margin-top: 5px; direction: ltr; }
        .bot-message .copy-container code { background: none; padding: 0; }
        .copy-btn { background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 1em; margin-left: 10px; transition: color 0.2s; }
        .copy-btn:hover { color: var(--primary-color); }
        .user-question { align-self: flex-end; background: var(--primary-dark); padding: 10px 15px; border-radius: 15px 15px 0 15px; max-width: 80%; text-align: left; }
        #chatbot-input { padding: 15px; border-top: 1px solid var(--primary-color); }
        #chatbot-lang-toggle { display: flex; justify-content: flex-end; margin-bottom: 10px; }
        #chatbot-lang-toggle button { background: none; border: 1px solid #475569; color: var(--text-light); padding: 5px 10px; border-radius: 8px; cursor: pointer; margin-left: 5px; }
        #chatbot-lang-toggle button.active { background: var(--primary-color); border-color: var(--primary-color); color: var(--text-white); }
        #chatbot-quick-questions { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        .quick-question-btn { background: transparent; border: 1px solid var(--primary-color); color: var(--primary-color); padding: 8px 12px; border-radius: 20px; cursor: pointer; transition: all 0.2s; }
        .quick-question-btn:hover { background: var(--primary-color); color: var(--text-white); }

        /* RTL Chatbot Styles */
        #chatbot-container.rtl { direction: rtl; }
        #chatbot-container.rtl .bot-message,
        #chatbot-container.rtl .user-question { text-align: right; }
        #chatbot-container.rtl .bot-message { border-radius: 15px 15px 0 15px; align-self: flex-end; }
        #chatbot-container.rtl .user-question { border-radius: 15px 15px 15px 0; align-self: flex-start; }
        #chatbot-container.rtl #chatbot-header .chatbot-title { text-align: right; }
        #chatbot-container.rtl #chatbot-lang-toggle { justify-content: flex-start; }
        #chatbot-container.rtl #chatbot-lang-toggle button { margin-left: 0; margin-right: 5px; }

        /* Media Query for Mobile Responsiveness */
        @media (max-width: 480px) {
            body {
                padding-top: 60px; /* Reduce top padding on small screens */
            }

            .profile {
                width: 95%; /* Allow it to be a bit wider on small screens */
            }

            #chat-toggle-btn {
                width: 55px;
                height: 55px;
                right: 15px;
            }

            #chatbot-container {
                width: calc(100% - 30px); /* Make chat window wider */
                max-width: none;
                left: 15px;
                right: 15px;
                bottom: 90px; /* Position it above the player */
            }
            
            .action-buttons {
                flex-direction: column; /* Stack buttons on very small screens */
                gap: 15px;
            }
        }
    </style>
</head>
<body>
<canvas id="bg-canvas"></canvas>

<!-- Auth Container -->
<div class="auth-container">
    <button id="login-btn-redesigned">
        <i class="fab fa-google"></i>
        <span>Sign In</span>
    </button>
    <div id="user-profile-area">
        <img id="auth-user-pic" src="" alt="User"/>
        <div id="user-menu">
            <span id="auth-user-name"></span>
            <button id="admin-menu-btn" class="menu-item-btn"><i class="fas fa-user-shield"></i> Admin Panel</button>
            <button id="logout-btn" class="menu-item-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
    </div>
</div>

<!-- Main Content -->
<div style="width: 100%; display: flex; flex-direction: column; align-items: center; gap: 20px;">
    <div class="profile">
        <div class="avatar-container">
            <div class="avatar-border"></div>
            <img id="profile-pic" src="https://i.ibb.co/mVDyZMTg/e3fbda5ef554577e5aa1e68d7fb2cda7.jpg" alt="Profile Picture">
        </div>
        <h1 id="user-name">Z E Z O</h1>
        <p class="quote">Follow your dream, not people.</p>
        <div class="social-icons">
          <a href="https://instagram.com/ze2ow" target="_blank" rel="noopener"><i class="fab fa-instagram"></i></a>
          <a href="https://discord.gg/JfGhPfDFA7" target="_blank" rel="noopener"><i class="fab fa-discord"></i></a>
          <a href="https://tiktok.com/@czezo" target="_blank" rel="noopener"><i class="fab fa-tiktok"></i></a>
        </div>
        
        <div class="action-section">
            <h3>Minecraft Server</h3>
            <div class="action-controls-wrapper">
                <div class="action-buttons">
                    <button id="whitelist-btn" class="action-btn">Whitelist</button>
                    <button id="gallery-btn" class="action-btn">Gallery</button>
                </div>
                <div id="whitelist-form" class="collapsible-content">
                    <div class="whitelist-inner-form">
                        <div class="mc-input-container">
                            <img id="mc-head-preview" alt="MC Head" src="https://crafatar.com/renders/head/8667ba71b85a4004af54457a9734eed7?overlay">
                            <input type="text" id="mc-username-input" placeholder="Username">
                        </div>
                        <button id="send-whitelist-btn"><i class="fas fa-paper-plane"></i></button>
                    </div>
                     <div id="whitelist-message"></div>
                     <div id="cooldown-timer"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="screenshot-gallery-container" id="gallery-section">
        <h2>Z E Z O SERVER</h2>
        <div class="upload-area">
            <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
            <p id="upload-prompt">Welcome! Enjoy the gallery.</p>
        </div>
        <input type="file" id="file-input" multiple accept="image/png, image/jpeg" style="display:none;">
        <div id="upload-message"></div>
        <div id="screenshot-grid"></div>
        <div class="pagination-controls">
            <button id="prev-page" class="pagination-btn" disabled>&lt; Prev</button>
            <div id="page-numbers"></div>
            <button id="next-page" class="pagination-btn" disabled>Next &gt;</button>
        </div>
    </div>
</div>

<!-- Modals -->
<div id="delete-modal" class="modal-overlay">
    <div class="modal-content">
        <h3>Confirm Deletion</h3>
        <p>Are you sure you want to permanently delete this image? This action cannot be undone.</p>
        <div class="modal-buttons">
            <button id="modal-cancel-btn" class="modal-btn">Cancel</button>
            <button id="modal-confirm-btn" class="modal-btn">Delete</button>
        </div>
    </div>
</div>

<div id="admin-modal" class="modal-overlay">
    <div class="modal-content admin-modal-content">
        <span class="modal-close-btn" id="admin-modal-close">&times;</span>
        <div id="admin-panel">
            <h2><i class="fas fa-user-shield"></i> Admin Panel</h2>
            <div class="admin-section">
                <h3>Site Settings</h3>
                <div class="toggle-switch">
                    <label for="uploads-toggle">Allow Image Uploads</label>
                    <label class="switch">
                        <input type="checkbox" id="uploads-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            <div class="admin-section">
                <h3>Whitelist Settings</h3>
                <div class="toggle-switch">
                    <label for="whitelist-enabled-toggle">Whitelist System Enabled</label>
                    <label class="switch">
                        <input type="checkbox" id="whitelist-enabled-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="admin-input-group">
                    <label for="cooldown-hours-input">Cooldown (Hours)</label>
                    <input type="number" id="cooldown-hours-input" min="0" style="width: 80px;">
                </div>
            </div>
            <div class="admin-section">
                <h3>User Management</h3>
                <div id="user-list"></div>
                <div class="add-admin-form">
                    <input type="email" id="add-admin-email" placeholder="Enter user's email to promote">
                    <button id="add-admin-btn" class="action-btn">Promote</button>
                </div>
                <div id="add-admin-message"></div>
            </div>
        </div>
    </div>
</div>


<div id="lightbox">
    <span id="lightbox-close">&times;</span>
    <div id="lightbox-content">
        <img id="lightbox-img" src="" alt="Fullscreen image">
        <div id="lightbox-info">
            <div id="lightbox-uploader"></div>
            <div id="lightbox-actions">
                <div id="lightbox-like-section" class="like-section"></div>
            </div>
        </div>
    </div>
</div>

<div id="profile-modal" class="modal-overlay">
  <div class="modal-content">
    <h3>Change Account Name</h3>
    <input id="new-account-name" type="text" maxlength="24" style="margin:18px 0 12px 0; padding:8px 12px; border-radius:8px; border:1px solid var(--primary-color); font-size:1.1em; width:90%;">
    <div id="profile-modal-message"></div>
    <div class="modal-buttons">
        <button id="close-profile-modal" class="modal-btn" style="background:#4a5568;">Cancel</button>
        <button id="save-account-name" class="modal-btn" style="background: var(--primary-dark);">Save</button>
    </div>
  </div>
</div>

<!-- Music Player -->
<div id="music-player">
    <div class="track-info">
        <div id="track-title" class="track-title">Music Player</div>
        <div id="track-artist" class="track-artist">Select a song</div>
    </div>
    <div class="controls">
        <button id="prev-track-btn"><i class="fas fa-backward"></i></button>
        <button id="play-pause-btn"><i class="fas fa-play"></i></button>
        <button id="next-track-btn"><i class="fas fa-forward"></i></button>
    </div>
</div>
<audio id="audio-player" src=""></audio>

<!-- Chatbot -->
<div id="chat-toggle-btn">
    <i class="fas fa-robot"></i>
</div>
<div id="chatbot-container">
    <div id="chatbot-header">
        <img src="https://i.pinimg.com/736x/b6/90/8c/b6908c29b90393740e304ba8ac2e5389.jpg" alt="Bot">
        <div class="chatbot-title">
            <h3>Server Helper</h3>
            <span>Online</span>
        </div>
        <button id="chatbot-close-btn">&times;</button>
    </div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input">
        <div id="chatbot-lang-toggle"></div>
        <div id="chatbot-quick-questions"></div>
    </div>
</div>

<!-- SCRIPT SECTION -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script type="module">
    // Firebase SDK Imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, addDoc, serverTimestamp, query, where, deleteDoc, updateDoc, runTransaction, increment, getDocs } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // --- CONFIGURATION ---
    const IMGBB_API_KEY = "f4674c56e25d7969059afe104aa60375"; 
    const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1383889727421288540/_l90nWGp2YlMUP6TXn0qz8u0OcHwtcXjkNJtEtTSFRzYXcqlVXT-w5Jp5C65vSJXHWnE";
    const firebaseConfig = { apiKey: "AIzaSyDHtwRzPA4EvInGeCDCcRlb4n8I4k2W9Ik", authDomain: "zezo-393a7.firebaseapp.com", projectId: "zezo-393a7", storageBucket: "zezo-393a7.appspot.com", messagingSenderId: "528457075385", appId: "1:528457075385:web:71dfaa69694c090c842968", measurementId: "G-00RHFXMRMN" };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // DOM Element References
    const dom = {
        loginBtn: document.getElementById('login-btn-redesigned'),
        logoutBtn: document.getElementById('logout-btn'),
        userProfileArea: document.getElementById('user-profile-area'),
        authUserName: document.getElementById('auth-user-name'),
        authUserPic: document.getElementById('auth-user-pic'),
        userMenu: document.getElementById('user-menu'),
        adminMenuBtn: document.getElementById('admin-menu-btn'),
        adminModal: document.getElementById('admin-modal'),
        adminModalClose: document.getElementById('admin-modal-close'),
        whitelistBtn: document.getElementById('whitelist-btn'),
        galleryBtn: document.getElementById('gallery-btn'),
        gallerySection: document.getElementById('gallery-section'),
        whitelistForm: document.getElementById('whitelist-form'),
        mcUsernameInput: document.getElementById('mc-username-input'),
        sendWhitelistBtn: document.getElementById('send-whitelist-btn'),
        whitelistMessage: document.getElementById('whitelist-message'),
        cooldownTimer: document.getElementById('cooldown-timer'),
        uploadArea: document.querySelector('.upload-area'),
        fileInput: document.getElementById('file-input'),
        uploadPrompt: document.getElementById('upload-prompt'),
        uploadMessage: document.getElementById('upload-message'),
        screenshotGrid: document.getElementById('screenshot-grid'),
        prevPageBtn: document.getElementById('prev-page'),
        nextPageBtn: document.getElementById('next-page'),
        pageNumbersContainer: document.getElementById('page-numbers'),
        deleteModal: document.getElementById('delete-modal'),
        modalCancelBtn: document.getElementById('modal-cancel-btn'),
        modalConfirmBtn: document.getElementById('modal-confirm-btn'),
        lightbox: document.getElementById('lightbox'),
        lightboxImg: document.getElementById('lightbox-img'),
        lightboxClose: document.getElementById('lightbox-close'),
        lightboxUploader: document.getElementById('lightbox-uploader'),
        lightboxLikeSection: document.getElementById('lightbox-like-section'),
        profileModal: document.getElementById('profile-modal'),
        saveAccountNameBtn: document.getElementById('save-account-name'),
        closeProfileModalBtn: document.getElementById('close-profile-modal'),
        newAccountNameInput: document.getElementById('new-account-name'),
        profileModalMessage: document.getElementById('profile-modal-message'),
        mcHeadPreview: document.getElementById('mc-head-preview'),
        adminPanel: document.getElementById('admin-panel'),
        uploadsToggle: document.getElementById('uploads-toggle'),
        whitelistEnabledToggle: document.getElementById('whitelist-enabled-toggle'),
        cooldownHoursInput: document.getElementById('cooldown-hours-input'),
        userList: document.getElementById('user-list'),
        addAdminEmailInput: document.getElementById('add-admin-email'),
        addAdminBtn: document.getElementById('add-admin-btn'),
        addAdminMessage: document.getElementById('add-admin-message'),
        audioPlayer: document.getElementById('audio-player'),
        playPauseBtn: document.getElementById('play-pause-btn'),
        prevTrackBtn: document.getElementById('prev-track-btn'),
        nextTrackBtn: document.getElementById('next-track-btn'),
        trackTitle: document.getElementById('track-title'),
        trackArtist: document.getElementById('track-artist'),
        chatToggleBtn: document.getElementById('chat-toggle-btn'),
        chatbotContainer: document.getElementById('chatbot-container'),
        chatbotCloseBtn: document.getElementById('chatbot-close-btn'),
        chatbotMessages: document.getElementById('chatbot-messages'),
        chatbotLangToggle: document.getElementById('chatbot-lang-toggle'),
        chatbotQuickQuestions: document.getElementById('chatbot-quick-questions'),
    };

    // --- Global State ---
    const ADMIN_EMAIL = "d4eners@gmail.com";
    let currentUser = null;
    let currentUserRole = 'user';
    let allImages = [];
    let siteSettings = { 
        uploadsEnabled: true,
        whitelistEnabled: true,
        whitelistCooldownHours: 24 
    };
    let unsubscribe = { images: null, settings: null };
    let currentPage = 1;
    const IMAGES_PER_PAGE = 12;
    let anonymousUserId = '';
    let cooldownInterval = null;
    const playlist = [
        { src: 'https://audio.jukehost.co.uk/NyX3yPzdfL2ZuHa0CfG2ESdXr3Vz9qZL', title: 'C418 - Sweden', artist: 'Minecraft Soundtrack' },
        { src: 'https://audio.jukehost.co.uk/J9QkCMlTHAn9YskBBhw7HvKUmFEFSASo', title: 'C418 - Wet Hands', artist: 'Minecraft Soundtrack' },
        { src: 'https://audio.jukehost.co.uk/84NqEawpOxk9yYf3MemYh4l1xZ9v4pGq', title: 'C418 - Minecraft', artist: 'Minecraft Soundtrack' },
        { src: 'https://audio.jukehost.co.uk/yP3eF4a0a4P2m6f4B4A2m8n0a1N2f6N1', title: 'C418 - Subwoofer Lullaby', artist: 'Minecraft Soundtrack' },
        { src: 'https://audio.jukehost.co.uk/TSOMnXEzYVHrqKQcAbgHM27yd4vT98zi', title: 'C418 - Aria Math', artist: 'Minecraft Soundtrack' },
    ];
    let currentTrackIndex = 0;
    let isPlaying = false;
    let chatLanguage = 'ku'; // Default to Kurdish

    // --- HELPER FUNCTIONS ---
    function timeAgo(date) {
        if (!date) return 'a moment ago';
        const seconds = Math.floor((new Date() - date) / 1000);
        if (seconds < 5) return 'just now';
        const intervals = { year: 31536000, month: 2592000, day: 86400, hour: 3600, minute: 60, second: 1 };
        for (const [unit, secondsInUnit] of Object.entries(intervals)) {
            const interval = Math.floor(seconds / secondsInUnit);
            if (interval >= 1) return `${interval} ${unit}${interval > 1 ? 's' : ''} ago`;
        }
        return `${Math.floor(seconds)} seconds ago`;
    }

    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
    });

    // --- MAIN INITIALIZATION ---
    function init() {
        anonymousUserId = localStorage.getItem('anonymousUserId') || crypto.randomUUID();
        localStorage.setItem('anonymousUserId', anonymousUserId);
        
        setupEventListeners();
        initMusicPlayer();
        initChatbot();
        
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                const userRef = doc(db, "users", user.uid);
                const userDoc = await getDoc(userRef);
                const role = user.email === ADMIN_EMAIL ? 'admin' : 'user';
                currentUserRole = userDoc.exists() ? userDoc.data().role : role;
                
                if (!userDoc.exists()) {
                    await setDoc(userRef, { displayName: user.displayName, email: user.email, photoURL: user.photoURL, role, createdAt: serverTimestamp() });
                }
            } else {
                currentUserRole = 'user';
            }
            
            updateUIVisibility();
            fetchData();
        });
    }

    function updateUIVisibility() {
        if (currentUser) {
            dom.loginBtn.style.display = 'none';
            dom.userProfileArea.style.display = 'block';
            dom.authUserName.textContent = currentUser.displayName;
            dom.authUserPic.src = currentUser.photoURL;
            dom.adminMenuBtn.style.display = currentUserRole === 'admin' ? 'flex' : 'none';
        } else {
            dom.loginBtn.style.display = 'flex';
            dom.userProfileArea.style.display = 'none';
            dom.userMenu.classList.remove('visible');
        }
        
        const uploadsEnabledByAdmin = siteSettings.uploadsEnabled;
        const canUpload = uploadsEnabledByAdmin && currentUser;

        dom.uploadArea.classList.toggle('disabled', !canUpload);

        if (!uploadsEnabledByAdmin) {
            dom.uploadPrompt.innerHTML = 'Uploads are temporarily disabled while we work on an issue.';
        } else if (!currentUser) {
             dom.uploadPrompt.innerHTML = 'Please <strong>Sign In</strong> to upload images.';
        } else {
            dom.uploadPrompt.innerHTML = '<strong>Drag & drop</strong> screenshots, or <strong>click to select</strong>.';
        }
        
        renderPage(); 
    }
    
    // --- DATA FETCHING ---
    function fetchData() {
        if (unsubscribe.images) unsubscribe.images();
        if (unsubscribe.settings) unsubscribe.settings();

        const settingsRef = doc(db, "config", "settings");
        // FIX: Changed to getDoc for non-admins to avoid permission errors
        if (currentUserRole === 'admin') {
            unsubscribe.settings = onSnapshot(settingsRef, (docSnap) => {
                if (docSnap.exists()) {
                    siteSettings = { ...siteSettings, ...docSnap.data() };
                } else {
                    setDoc(settingsRef, siteSettings);
                }
                dom.uploadsToggle.checked = siteSettings.uploadsEnabled;
                dom.whitelistEnabledToggle.checked = siteSettings.whitelistEnabled;
                dom.cooldownHoursInput.value = siteSettings.whitelistCooldownHours;
                updateUIVisibility();
            }, (error) => {
                console.error("Admin error fetching site settings:", error.message);
                updateUIVisibility();
            });
        } else {
            getDoc(settingsRef).then(docSnap => {
                if (docSnap.exists()) {
                    siteSettings = { ...siteSettings, ...docSnap.data() };
                }
                updateUIVisibility();
            }).catch(error => {
                console.log("Could not fetch remote settings, using defaults. This is expected for non-admins.");
                updateUIVisibility();
            });
        }

        let q = collection(db, "images");
        if (currentUserRole !== 'admin') {
            q = query(q, where("hidden", "==", false));
        }
        
        unsubscribe.images = onSnapshot(q, (snapshot) => {
            allImages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            allImages.sort((a, b) => (b.createdAt?.toDate() || 0) - (a.createdAt?.toDate() || 0));
            renderPage();
        }, (error) => {
            console.error("Error fetching images:", error);
            dom.screenshotGrid.innerHTML = `<p style="color: #fca5a5; grid-column: 1 / -1;">Error loading gallery.</p>`;
        });

        if (currentUserRole === 'admin') {
            fetchUsersForAdminPanel();
        }
    }

    // --- IMAGE GALLERY & UPLOAD ---
    async function handleFiles(files) {
        if (!siteSettings.uploadsEnabled) {
            dom.uploadMessage.textContent = "Uploads are currently disabled.";
            return;
        }
        if (!currentUser) {
             dom.uploadMessage.textContent = "Please log in to upload images.";
            return;
        }
        // ... (rest of the handleFiles logic is the same)
    }

    function renderPage() {
        dom.screenshotGrid.innerHTML = '';
        const totalPages = Math.ceil(allImages.length / IMAGES_PER_PAGE) || 1;
        if (currentPage > totalPages) currentPage = totalPages;
        const pageImages = allImages.slice((currentPage - 1) * IMAGES_PER_PAGE, currentPage * IMAGES_PER_PAGE);

        if (pageImages.length === 0) {
             dom.screenshotGrid.innerHTML = `<p style="color: #aaa; grid-column: 1 / -1;">The gallery is empty.</p>`;
        } else {
             pageImages.forEach(imgData => dom.screenshotGrid.appendChild(createImageItem(imgData)));
        }
        renderPaginationControls(totalPages);
    }

    function createImageItem(imgData) {
        const item = document.createElement('div');
        item.className = 'screenshot-item';
        if (imgData.hidden) item.classList.add('hidden-by-admin');
        item.addEventListener('click', () => openLightbox(imgData));

        const img = document.createElement('img');
        img.src = imgData.imageUrl;
        img.alt = 'Minecraft Screenshot';
        img.className = 'main-img';
        img.loading = 'lazy';
        
        item.appendChild(img);
        
        const isOwner = currentUser?.uid === imgData.uploaderUid;
        const isAdmin = currentUserRole === 'admin';

        if(isOwner || isAdmin) {
            const controls = document.createElement('div');
            controls.className = 'image-controls';
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'control-btn delete-btn';
            deleteBtn.title = 'Delete';
            deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
            deleteBtn.onclick = (e) => { e.stopPropagation(); confirmDeleteImage(imgData.id); };
            controls.appendChild(deleteBtn);

            if (isAdmin) {
                const hideBtn = document.createElement('button');
                hideBtn.className = 'control-btn hide-btn';
                hideBtn.title = imgData.hidden ? 'Show' : 'Hide';
                hideBtn.innerHTML = `<i class="fas fa-eye${imgData.hidden ? '-slash' : ''}"></i>`;
                hideBtn.onclick = (e) => { e.stopPropagation(); toggleImageVisibility(imgData.id, !imgData.hidden); };
                controls.appendChild(hideBtn);
            }
            item.appendChild(controls);
        }
        return item;
    }

    // --- PAGINATION ---
    function renderPaginationControls(totalPages) {
        dom.pageNumbersContainer.innerHTML = '';
        for (let i = 1; i <= totalPages; i++) {
            const pageNum = document.createElement('span');
            pageNum.className = 'page-number';
            pageNum.textContent = i;
            if (i === currentPage) pageNum.classList.add('active');
            pageNum.addEventListener('click', () => { currentPage = i; renderPage(); });
            dom.pageNumbersContainer.appendChild(pageNum);
        }
        dom.prevPageBtn.disabled = currentPage === 1;
        dom.nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
    }

    // --- LIGHTBOX ---
    function openLightbox(imgData) {
        dom.lightboxImg.src = imgData.imageUrl;
        
        dom.lightboxUploader.innerHTML = `
            <img src="${imgData.uploaderPic}" alt="${imgData.uploaderName}">
            <div>
                <div class="name">${imgData.uploaderName}</div>
                <div class="time-ago" style="font-size: 0.8em;">${timeAgo(imgData.createdAt?.toDate())}</div>
            </div>`;
        
        updateLightboxLikeSection(imgData);
        
        dom.lightbox.classList.add('visible');
        
        const viewerId = currentUser ? currentUser.uid : anonymousUserId;
        const viewKey = `viewed_${imgData.id}_by_${viewerId}`;
        if (!localStorage.getItem(viewKey)) {
            const imageRef = doc(db, "images", imgData.id);
            updateDoc(imageRef, { views: increment(1) })
                .then(() => localStorage.setItem(viewKey, 'true'))
                .catch(err => console.error("Error updating view count:", err));
        }
    }

    function updateLightboxLikeSection(imgData) {
        const likerId = currentUser ? currentUser.uid : anonymousUserId;
        const isLiked = imgData.likes?.includes(likerId);
        dom.lightboxLikeSection.innerHTML = `<i class="fas fa-heart"></i> <span>${(imgData.likes || []).length}</span>`;
        dom.lightboxLikeSection.classList.toggle('liked', isLiked);
        
        const newLikeSection = dom.lightboxLikeSection.cloneNode(true);
        newLikeSection.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleLike(imgData.id);
        });
        dom.lightboxLikeSection.parentNode.replaceChild(newLikeSection, dom.lightboxLikeSection);
        dom.lightboxLikeSection = newLikeSection;
    }

    // --- LIKE LOGIC ---
    async function toggleLike(imageId) {
        const likerId = currentUser ? currentUser.uid : anonymousUserId;
        const imageRef = doc(db, "images", imageId);

        const heartIcon = document.querySelector(`.like-section[data-id="${imageId}"] .fa-heart`) || dom.lightboxLikeSection.querySelector('.fa-heart');
        if (heartIcon) {
            heartIcon.classList.add('animating');
            heartIcon.onanimationend = () => heartIcon.classList.remove('animating');
        }
        
        try {
            await runTransaction(db, async (transaction) => {
                const imageDoc = await transaction.get(imageRef);
                if (!imageDoc.exists()) throw "Document does not exist!";
                
                const data = imageDoc.data();
                const likesArr = data.likes || [];
                const likeIndex = likesArr.indexOf(likerId);

                if (likeIndex === -1) likesArr.push(likerId);
                else likesArr.splice(likeIndex, 1);
                
                transaction.update(imageRef, { likes: likesArr });
            });
        } catch (e) {
            console.error("Like transaction failed: ", e);
        }
    }

    // --- WHITELIST LOGIC ---
    async function handleWhitelistRequest() {
        if (!siteSettings.whitelistEnabled) {
            dom.whitelistMessage.textContent = "Whitelist system is currently disabled.";
            return;
        }
        if (!currentUser) {
            dom.whitelistMessage.textContent = "Please sign in to send a request.";
            return;
        }

        const username = dom.mcUsernameInput.value.trim();
        if (!username) {
            dom.whitelistMessage.textContent = "Please enter a username.";
            return;
        }

        if (currentUserRole === 'admin') {
            sendRequest(username);
            return;
        }

        const requestRef = doc(db, "whitelistRequests", currentUser.uid);
        const requestDoc = await getDoc(requestRef);
        const cooldownMs = siteSettings.whitelistCooldownHours * 60 * 60 * 1000;

        if (requestDoc.exists()) {
            const lastRequestTime = requestDoc.data().timestamp.toMillis();
            const timeSince = Date.now() - lastRequestTime;

            if (timeSince < cooldownMs) {
                startCooldownTimer(cooldownMs - timeSince);
                return;
            }
        }
        
        await sendRequest(username);
        await setDoc(requestRef, { timestamp: serverTimestamp() });
    }

    function startCooldownTimer(msLeft) {
        clearInterval(cooldownInterval);
        let timeLeft = msLeft;

        const updateTimer = () => {
            if (timeLeft <= 0) {
                clearInterval(cooldownInterval);
                dom.cooldownTimer.textContent = "";
                dom.sendWhitelistBtn.disabled = false;
                return;
            }

            const hours = Math.floor(timeLeft / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

            dom.cooldownTimer.textContent = `Next request in: ${hours}h ${minutes}m ${seconds}s`;
            dom.sendWhitelistBtn.disabled = true;
            timeLeft -= 1000;
        };

        updateTimer();
        cooldownInterval = setInterval(updateTimer, 1000);
    }

    async function sendRequest(username) {
        dom.whitelistMessage.textContent = "Sending...";
        dom.sendWhitelistBtn.disabled = true;
        
        let ip = "Unknown";
        let locationInfo = "Unknown";
        try {
            const ipRes = await fetch("https://ipapi.co/json/");
            if (ipRes.ok) {
                const ipData = await ipRes.json();
                ip = ipData.ip || "Unknown";
                locationInfo = `${ipData.city || ""}, ${ipData.region || ""}, ${ipData.country_name || ""}`;
            }
        } catch (e) { console.error("Could not fetch IP info:", e); }

        const discordPayload = {
            content: `New whitelist request from **${currentUser?.displayName || 'Anonymous'}**`,
            embeds: [{
                title: "Whitelist Request Details",
                color: 11027200,
                fields: [
                    { name: "Minecraft Username", value: `\`${username}\``, inline: true },
                    { name: "Requester", value: `\`${currentUser?.displayName || 'Anonymous'}\``, inline: true },
                    { name: "Email", value: `\`${currentUser?.email || 'N/A'}\``, inline: false },
                    { name: "IP Address", value: `\`${ip}\``, inline: true },
                    { name: "Approx. Location", value: `\`${locationInfo}\``, inline: true },
                    { name: "User Agent", value: `\`\`\`${navigator.userAgent}\`\`\``, inline: false },
                ],
                timestamp: new Date().toISOString()
            }]
        };

        try {
            const response = await fetch(DISCORD_WEBHOOK_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(discordPayload)
            });
            if (!response.ok) throw new Error(`API error: ${response.status}`);
            dom.whitelistMessage.textContent = "Request sent successfully!";
            dom.mcUsernameInput.value = '';
        } catch (error) {
            console.error("Webhook error:", error);
            dom.whitelistMessage.textContent = "Webhook failed. Check URL.";
        }
        
        dom.sendWhitelistBtn.disabled = false;
        setTimeout(() => { dom.whitelistMessage.textContent = ''; }, 5000);
    }
    
    // --- ADMIN & DELETION LOGIC ---
    async function toggleImageVisibility(docId, shouldBeHidden) { await updateDoc(doc(db, "images", docId), { hidden: shouldBeHidden }); }
    
    function confirmDeleteImage(docId) {
        dom.deleteModal.classList.add('visible');
        const confirmHandler = () => { deleteImage(docId); cleanup(); };
        const cancelHandler = () => cleanup();
        const cleanup = () => {
            dom.deleteModal.classList.remove('visible');
            dom.modalConfirmBtn.removeEventListener('click', confirmHandler);
            dom.modalCancelBtn.removeEventListener('click', cancelHandler);
        };
        dom.modalConfirmBtn.addEventListener('click', confirmHandler);
        dom.modalCancelBtn.addEventListener('click', cancelHandler);
    }

    async function deleteImage(docId) {
        try { await deleteDoc(doc(db, "images", docId)); } catch (error) { console.error("Error deleting image: ", error); }
    }

    async function fetchUsersForAdminPanel() {
        const usersRef = collection(db, "users");
        const snapshot = await getDocs(usersRef);
        dom.userList.innerHTML = '';
        snapshot.forEach(doc => {
            const user = { id: doc.id, ...doc.data() };
            const userItem = document.createElement('div');
            userItem.className = 'user-item';
            userItem.innerHTML = `
                <div class="user-info">
                    <img src="${user.photoURL}" alt="${user.displayName}">
                    <span>${user.displayName} (${user.email})</span>
                </div>
                <button class="modal-btn user-role-btn" data-uid="${user.id}" data-role="${user.role}">
                    ${user.role === 'admin' ? 'Demote' : 'Promote'}
                </button>
            `;
            dom.userList.appendChild(userItem);
        });
    }

    async function handleRoleChange(e) {
        if (!e.target.classList.contains('user-role-btn')) return;
        
        const btn = e.target;
        const uid = btn.dataset.uid;
        const currentRole = btn.dataset.role;
        const newRole = currentRole === 'admin' ? 'user' : 'admin';

        if (uid === currentUser.uid) {
            alert("You cannot change your own role.");
            return;
        }

        btn.textContent = 'Updating...';
        btn.disabled = true;
        
        const userRef = doc(db, "users", uid);
        await updateDoc(userRef, { role: newRole });
        
        fetchUsersForAdminPanel();
    }

    async function addAdminByEmail() {
        const email = dom.addAdminEmailInput.value.trim();
        if (!email) {
            dom.addAdminMessage.textContent = "Please enter an email.";
            return;
        }

        dom.addAdminMessage.textContent = "Searching for user...";
        const usersRef = collection(db, "users");
        const q = query(usersRef, where("email", "==", email));
        
        try {
            const querySnapshot = await getDocs(q);
            if (querySnapshot.empty) {
                dom.addAdminMessage.textContent = "User with that email not found.";
                return;
            }

            querySnapshot.forEach(async (userDoc) => {
                const userRef = doc(db, "users", userDoc.id);
                await updateDoc(userRef, { role: "admin" });
                dom.addAdminMessage.textContent = `Successfully promoted ${email}!`;
                dom.addAdminEmailInput.value = "";
                fetchUsersForAdminPanel(); // Refresh list
            });
        } catch (error) {
            console.error("Error promoting user:", error);
            dom.addAdminMessage.textContent = "An error occurred.";
        }
        setTimeout(() => dom.addAdminMessage.textContent = '', 4000);
    }

    // --- MUSIC PLAYER LOGIC ---
    // FIX: Added error handling to audio playback
    function initMusicPlayer() {
        updateTrackDisplay();
        dom.audioPlayer.volume = 0.5;
        dom.audioPlayer.addEventListener('error', (e) => {
            console.error("Audio Player Error:", e);
            dom.trackTitle.textContent = "Playback Error";
            dom.trackArtist.textContent = "Could not load song.";
            isPlaying = false;
            dom.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        });
    }

    function updateTrackDisplay() {
        const track = playlist[currentTrackIndex];
        dom.trackTitle.textContent = track.title;
        dom.trackArtist.textContent = track.artist;
    }

    async function playPauseTrack() {
        if (isPlaying) {
            dom.audioPlayer.pause();
            dom.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            isPlaying = false;
        } else {
            try {
                dom.audioPlayer.src = playlist[currentTrackIndex].src;
                await dom.audioPlayer.play();
                dom.playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                isPlaying = true;
            } catch (error) {
                console.error("Audio playback error:", error.name, error.message);
                dom.trackTitle.textContent = "Error";
                dom.trackArtist.textContent = "Could not load track";
                isPlaying = false;
            }
        }
    }

    async function changeTrack(direction) {
        currentTrackIndex = (currentTrackIndex + direction + playlist.length) % playlist.length;
        updateTrackDisplay();
        if (isPlaying) {
            try {
                dom.audioPlayer.src = playlist[currentTrackIndex].src;
                await dom.audioPlayer.play();
            } catch (error) {
                console.error("Audio playback error on track change:", error.name, error.message);
                dom.trackTitle.textContent = "Error";
                dom.trackArtist.textContent = "Could not load track";
                isPlaying = false;
                dom.playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }
    }

    // --- CHATBOT LOGIC ---
    const chatResponses = {
        en: {
            welcome: "Hello! How can I help you join the server?",
            questions: {
                java: "How to join on Java?",
                bedrock: "How to join on Bedrock?",
            },
            answers: {
                java: "First, get whitelisted. Then, add the server with this address:<div class='copy-container'><code>tiriniox.serveminecraft.net:24565</code><button class='copy-btn' data-copy='tiriniox.serveminecraft.net:24565'><i class='fas fa-copy'></i></button></div>",
                bedrock: "First, get whitelisted. Then, join this server:<div class='copy-container'><code>eu.geyserconnect.net</code><button class='copy-btn' data-copy='eu.geyserconnect.net'><i class='fas fa-copy'></i></button></div>Use port <code>19132</code>. After joining, you will be prompted to add our server."
            }
        },
        ku: {
            welcome: "!       ",
            questions: {
                java: "    ",
                bedrock: "    ",
            },
            answers: {
                java: "     .      :<div class='copy-container'><code>tiriniox.serveminecraft.net:24565</code><button class='copy-btn' data-copy='tiriniox.serveminecraft.net:24565'><i class='fas fa-copy'></i></button></div>",
                bedrock: "   .     :<div class='copy-container'><code>eu.geyserconnect.net</code><button class='copy-btn' data-copy='eu.geyserconnect.net'><i class='fas fa-copy'></i></button></div> <code>19132</code> .          ."
            }
        }
    };

    function setChatLanguage(lang) {
        chatLanguage = lang;
        localStorage.setItem('chatLanguage', lang);
        if (lang === 'ku') {
            dom.chatbotContainer.classList.add('rtl');
        } else {
            dom.chatbotContainer.classList.remove('rtl');
        }
        renderChatUI();
    }

    function addBotMessage(text) {
        const messageEl = document.createElement('div');
        messageEl.className = 'bot-message';
        messageEl.innerHTML = text;
        dom.chatbotMessages.appendChild(messageEl);

        messageEl.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                copyToClipboard(btn.dataset.copy, btn);
            });
        });

        dom.chatbotMessages.scrollTop = dom.chatbotMessages.scrollHeight;
    }

    function copyToClipboard(text, btn) {
        const originalText = btn.innerHTML;
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        btn.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
            btn.innerHTML = originalText;
        }, 2000);
    }

    function handleQuickQuestion(key) {
        const questionText = chatResponses[chatLanguage].questions[key];
        const answerText = chatResponses[chatLanguage].answers[key];

        const userMessageEl = document.createElement('div');
        userMessageEl.className = 'user-question';
        userMessageEl.textContent = questionText;
        dom.chatbotMessages.appendChild(userMessageEl);

        setTimeout(() => addBotMessage(answerText), 500);
    }

    function renderChatUI() {
        // Render language toggle
        dom.chatbotLangToggle.innerHTML = `
            <button data-lang="en" class="${chatLanguage === 'en' ? 'active' : ''}">EN</button>
            <button data-lang="ku" class="${chatLanguage === 'ku' ? 'active' : ''}">KU</button>
        `;
        dom.chatbotLangToggle.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => setChatLanguage(btn.dataset.lang));
        });

        // Render welcome message and questions
        dom.chatbotMessages.innerHTML = '';
        dom.chatbotQuickQuestions.innerHTML = '';
        addBotMessage(chatResponses[chatLanguage].welcome);

        for (const key in chatResponses[chatLanguage].questions) {
            const button = document.createElement('button');
            button.className = 'quick-question-btn';
            button.textContent = chatResponses[chatLanguage].questions[key];
            button.addEventListener('click', () => handleQuickQuestion(key));
            dom.chatbotQuickQuestions.appendChild(button);
        }
    }

    function initChatbot() {
        const savedLang = localStorage.getItem('chatLanguage') || 'ku'; // Default to Kurdish
        setChatLanguage(savedLang);
    }

    // --- SKIN PREVIEW ---
    async function updateSkinPreview() {
        const username = dom.mcUsernameInput.value.trim();
        const steveHeadUrl = 'https://crafatar.com/renders/head/8667ba71b85a4004af54457a9734eed7?overlay';

        if (username.length < 3) {
            dom.mcHeadPreview.src = steveHeadUrl;
            return;
        }

        try {
            const response = await fetch(`https://corsproxy.io/?https://api.mojang.com/users/profiles/minecraft/${username}`);
            if (!response.ok) {
                dom.mcHeadPreview.src = steveHeadUrl;
                return;
            }
            const data = await response.json();
            if (data && data.id) {
                dom.mcHeadPreview.src = `https://crafatar.com/renders/head/${data.id}?overlay`;
            } else {
                dom.mcHeadPreview.src = steveHeadUrl;
            }
        } catch (error) {
            console.error("Error fetching Minecraft UUID:", error);
            dom.mcHeadPreview.src = steveHeadUrl;
        }
    }

    // --- EVENT LISTENERS ---
    function setupEventListeners() {
        dom.loginBtn.addEventListener('click', () => signInWithPopup(auth, provider));
        
        dom.logoutBtn.addEventListener('click', () => {
            signOut(auth);
            dom.userMenu.classList.remove('visible');
        });
        dom.authUserPic.addEventListener('click', (e) => {
            e.stopPropagation(); 
            dom.userMenu.classList.toggle('visible');
        });
        window.addEventListener('click', () => {
            if(dom.userMenu.classList.contains('visible')) {
                dom.userMenu.classList.remove('visible');
            }
        });

        dom.adminMenuBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            dom.adminModal.classList.add('visible');
            dom.userMenu.classList.remove('visible');
        });
        dom.adminModalClose.addEventListener('click', () => {
            dom.adminModal.classList.remove('visible');
        });


        dom.galleryBtn.addEventListener('click', () => dom.gallerySection.classList.toggle('visible'));
        dom.whitelistBtn.addEventListener('click', () => dom.whitelistForm.classList.toggle('visible'));
        dom.sendWhitelistBtn.addEventListener('click', handleWhitelistRequest);
        
        let skinUpdateTimeout;
        dom.mcUsernameInput.addEventListener('input', () => {
            clearTimeout(skinUpdateTimeout);
            skinUpdateTimeout = setTimeout(updateSkinPreview, 500);
        });
        
        dom.uploadArea.addEventListener('click', () => {
             if (!siteSettings.uploadsEnabled) {
                 dom.uploadMessage.textContent = "Uploads are temporarily disabled while we work on an issue.";
                 setTimeout(() => dom.uploadMessage.textContent = '', 3000);
                 return;
            }
             if (!currentUser) {
                 dom.uploadMessage.textContent = "Please sign in to upload images.";
                 setTimeout(() => dom.uploadMessage.textContent = '', 3000);
                 return;
            }
            dom.fileInput.click();
        });

        dom.fileInput.addEventListener('change', (e) => handleFiles(e.target.files));
        dom.prevPageBtn.addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderPage(); } });
        dom.nextPageBtn.addEventListener('click', () => { if (currentPage < Math.ceil(allImages.length / IMAGES_PER_PAGE)) { currentPage++; renderPage(); } });
        dom.lightboxClose.addEventListener('click', () => dom.lightbox.classList.remove('visible'));
        
        dom.closeProfileModalBtn.addEventListener('click', () => dom.profileModal.classList.remove('visible'));
        
        const settingsRef = doc(db, "config", "settings");
        dom.uploadsToggle.addEventListener('change', (e) => updateDoc(settingsRef, { uploadsEnabled: e.target.checked }));
        dom.whitelistEnabledToggle.addEventListener('change', (e) => updateDoc(settingsRef, { whitelistEnabled: e.target.checked }));
        dom.cooldownHoursInput.addEventListener('change', (e) => {
            const hours = parseInt(e.target.value, 10);
            if (!isNaN(hours) && hours >= 0) {
                updateDoc(settingsRef, { whitelistCooldownHours: hours });
            }
        });

        dom.userList.addEventListener('click', handleRoleChange);
        dom.addAdminBtn.addEventListener('click', addAdminByEmail);

        dom.playPauseBtn.addEventListener('click', playPauseTrack);
        dom.nextTrackBtn.addEventListener('click', () => changeTrack(1));
        dom.prevTrackBtn.addEventListener('click', () => changeTrack(-1));
        dom.audioPlayer.addEventListener('ended', () => changeTrack(1));

        // Chatbot listeners
        dom.chatToggleBtn.addEventListener('click', () => dom.chatbotContainer.classList.toggle('visible'));
        dom.chatbotCloseBtn.addEventListener('click', () => dom.chatbotContainer.classList.remove('visible'));
    }

    // --- START THE APP ---
    init();

</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    if (typeof THREE === 'undefined') {
        console.error('Three.js is not loaded.');
        return;
    }

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
    camera.position.z = 1;
    
    const canvas = document.getElementById('bg-canvas');
    const renderer = new THREE.WebGLRenderer({
        canvas: canvas,
        antialias: true,
        alpha: true // Make canvas transparent
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0x000000, 0); // Transparent background

    // Starfield
    const starVertices = [];
    for (let i = 0; i < 10000; i++) {
        const x = (Math.random() - 0.5) * 2000;
        const y = (Math.random() - 0.5) * 2000;
        const z = (Math.random() - 1) * 2000;
        starVertices.push(x, y, z);
    }
    const starGeometry = new THREE.BufferGeometry();
    starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
    const starMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 0.7,
        transparent: true,
        blending: THREE.AdditiveBlending,
    });
    const stars = new THREE.Points(starGeometry, starMaterial);
    scene.add(stars);

    const particleCount = 200;
    const particleVertices = [];
    const particleVelocities = [];
    const particleGeometry = new THREE.BufferGeometry();
    const particleMaterial = new THREE.PointsMaterial({
        color: 0xa855f7,
        size: 1.5,
        transparent: true,
        blending: THREE.AdditiveBlending,
        opacity: 0.7,
        depthWrite: false,
    });

    for (let i = 0; i < particleCount; i++) {
        const x = Math.random() * 1000 - 500;
        const y = Math.random() * 1000 - 800; // Start below the screen
        const z = Math.random() * 400 - 200;
        particleVertices.push(x, y, z);
        particleVelocities.push(
            (Math.random() - 0.5) * 0.1, // x velocity
            Math.random() * 0.5 + 0.2,   // y velocity (upwards)
            (Math.random() - 0.5) * 0.1  // z velocity
        );
    }
    particleGeometry.setAttribute('position', new THREE.Float32BufferAttribute(particleVertices, 3));
    const fireParticles = new THREE.Points(particleGeometry, particleMaterial);
    scene.add(fireParticles);

    let mouseX = 0;
    let mouseY = 0;
    document.addEventListener('mousemove', (event) => {
        mouseX = event.clientX;
        mouseY = event.clientY;
    });

    const clock = new THREE.Clock();
    const animate = () => {
        const elapsedTime = clock.getElapsedTime();

        stars.position.z += 0.1;
        if(stars.position.z > 1000) stars.position.z = -1000;

        // Animate fire particles
        const positions = fireParticles.geometry.attributes.position.array;
        for (let i = 0; i < particleCount; i++) {
            positions[i * 3 + 1] += particleVelocities[i * 3 + 1]; // Update y position
            positions[i * 3] += particleVelocities[i * 3]; // Update x position
            // Reset particle if it goes too high
            if (positions[i * 3 + 1] > 500) {
                positions[i * 3 + 1] = -500;
                positions[i * 3] = Math.random() * 1000 - 500;
            }
        }
        fireParticles.geometry.attributes.position.needsUpdate = true;


        camera.position.x += (mouseX / window.innerWidth * 0.5 - camera.position.x) * 0.02;
        camera.position.y += (-(mouseY / window.innerHeight) * 0.5 - camera.position.y) * 0.02;
        camera.lookAt(scene.position);

        renderer.render(scene, camera);
        requestAnimationFrame(animate);
    };

    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    });

    animate();
});
</script>
</body>
</html>
